---
title: "1. Choice RT task"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(jaysire)
set.seed(143)
```

In this example we'll build a relatively simple choice reaction time experiment. On any given trial, the participant will be presented with a blue circle or an orange circle, and will respond by pressing the "F" or "J" keys. It is almost identical to the [demonstration experiment](https://www.jspsych.org/tutorials/rt-task/) used in the jsPsych documentation. 

## Creating the resource files

```{r resources, message = FALSE}
library(ggplot2)

# where should the images be stored initially?
resources <- temporary_folder()  
blue_image <- file.path(resources, "blue.png")
orange_image <- file.path(resources, "orange.png")

# create the blue circle plot
blue_pic <- ggplot() + theme_void() +
  annotate(geom = "point", x = 0, y = 0, colour = "blue", size = 60)

# create the orange circle plot
orange_pic <- ggplot() + theme_void() +
  annotate(geom = "point", x = 0, y = 0, colour = "orange", size = 60)

# save the images to files in the resource folder
ggsave(filename = blue_image, plot = blue_pic, width = 2, height = 2)
ggsave(filename = orange_image, plot = orange_pic, width = 2, height = 2)

# check that it worked
list.files(resources)
```


## Defining instructions

```{r instructions}
welcome <- trial_html_keyboard_response(
  "Welcome to the experiment! Press any key to begin"
)

finish <- trial_html_keyboard_response(
  stimulus = "Thank you!", 
  choices = respond_no_key(),
  trial_duration = 2000
)

page1 <- paste0(
  "In this experiment, a circle will appear in the centre of the screen. ",
  "If the circle is <b>blue</b>, press the letter F on the keyboard as fast ",
  "as you can. If the circle is <b>orange</b>, press the letter J as fast as",
  "you can. Click 'Next' to see examples.<br>"
)

page2 <- paste0(
  "If you see this blue circle, press F. <br>", 
  "<img src = '", insert_resource("blue.png"), "' width = 300px>"
)

page3 <- paste0(
  "If you see this orange circle, press J. <br>", 
  "<img src = '", insert_resource("orange.png"), "' width = 300px>"
)

page4 <- "Click the 'Next' button when you are ready to begin."

instructions <- trial_instructions(
  pages = c(page1, page2, page3, page4), 
  show_clickable_nav = TRUE,
  post_trial_gap = 2000
)
```

## Defining the experiment trials

```{r}
fn_sample <- insert_javascript(
  "function(){
     return jsPsych.randomization.sampleWithoutReplacement(
       [250, 500, 750, 1000, 1250, 1500, 1750, 2000], 1)[0];
   }"
)

fixation <- trial_html_keyboard_response(
  stimulus = '<div style="font-size:60px;">+</div>',
  choices = respond_no_key(),
  trial_duration = fn_sample
)

test <- trial_image_keyboard_response(
  stimulus = insert_variable("circle"), 
  stimulus_height = 300,
  stimulus_width = 300,
  choices = c("f", "j")
)

trials <- build_timeline(fixation, test) %>%
  tl_add_variables(circle = insert_resource(c("orange.png", "blue.png"))) %>%
  tl_add_parameters(repetitions = 5, randomize_order = TRUE)
```


## Building the experiment

```{r experiment}
build_experiment(
  timeline = build_timeline(welcome, instructions, trials, finish),
  resources = build_resources(resources),
  path = "~/Desktop/myrt",
  on_finish = fn_save_locally()
)
```
